montageDefine("291d12f","core/abstract-stimulus",{dependencies:["montage/ui/component","ui/confirm.reel","ui/response.reel","montage/composer/press-composer","montage/core/range-controller","montage/core/promise"],factory:function(e,i){var o=e("montage/ui/component").Component,t=e("ui/confirm.reel").Confirm,n=(e("ui/response.reel").Response,e("montage/composer/press-composer").PressComposer),s=e("montage/core/range-controller").RangeController,a=e("montage/core/promise").Promise;i.AbstractStimulus=o.specialize({constructor:{value:function(){this.super(),window.audioEndListener=function(){var e=this.getAttribute("src");console.log("audiourl is done "+e)}}},rangeController:{value:null},responses:{value:null},pauseAudioWhenConfirmingResponse:{value:null},addResponse:{value:function(e,i){if(!e)throw"Cannot add response without the x y information found in the touch/click responseEvent";var o=Date.now(),n=this.audioElement.duration||0;n?n=1e3*n:console.log("The audio has no duration.. This is strange."),this.pauseAudioWhenConfirmingResponse&&this.pauseAudio();var s=this,r=this.confirmResponseChoiceMessage,u=a.defer();if(r){var l={iconSrc:s.ownerComponent.iconSrc,message:r,okLabel:"Yes",cancelLabel:"No"};t.show(l,function(){u.resolve()},function(){u.reject(Error("The x prevented the cancel?"))})}else u.resolve();u.promise.then(function(){s.stopAudio(),s.ownerComponent.nextStimulus()},function(){console.log("Not continuing to next stimulus"),this.pauseAudioWhenConfirmingResponse&&s.playAudio()});var o=Date.now(),c={reactionTimeAudioOffset:o-this.reactionTimeStart-n,reactionTimeAudioOnset:o-this.reactionTimeStart,x:e.x,y:e.y,pageX:e.pageX,pageY:e.pageY,chosenVisualStimulus:i,responseScore:1};this.responses.push(c),console.log("Recorded response",c)}},addNonResponse:{value:function(e){if(!e)throw"Cannot add response without the x y information found in the touch/click responseEvent";var i=Date.now(),o={reactionTimeAudioOffset:i-this.reactionTimeStart,reactionTimeAudioOnset:i-this.reactionTimeStart,x:e.x,y:e.y,pageX:e.pageX,pageY:e.pageY,chosenVisualStimulus:"none",responseScore:-1};this.nonResponses.push(o),console.log("Recorded non-response, the user is confused or not playing the game.",o)}},enterDocument:{value:function(e){this.super(),e&&(this.setupFirstPlay(),this.addOwnPropertyChangeListener("src",this)),this.reactionTimeStart=Date.now(),this.audioElement=document.getElementById("audio")}},handlePress:{value:function(e){console.log("The stimulus has been pressed: "),e&&e.targetElement&&e.targetElement.dataset&&e.targetElement.dataset.montageId&&e.targetElement.classList.contains("Stimulus-record-touch-response")?this.addResponse(e.event,e.targetElement.dataset.montageId):this.addNonResponse(e.event)}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},setupFirstPlay:{value:function(){this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("mousedown",this,!1),this._pressComposer=n.create(),this._pressComposer.identifier="stimulus",this.addComposerForElement(this._pressComposer,this.element)}},playAudio:{value:function(){this.audioElement.removeEventListener("ended",window.audioEndListener),this.audioElement.addEventListener("ended",window.audioEndListener),this.audioElement.play(),this.audioPlayStarted=Date.now()}},audioElement:{value:null},pauseAudio:{value:function(){this.audioElement.pause(),this.audioElement.currentTime>.05&&(this.audioElement.currentTime=this.audioElement.currentTime-.05)}},stopAudio:{value:function(){this.audioElement.pause(),this.audioElement.currentTime=0}},load:{value:function(e){for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);null===this.responses&&(this.responses=[]),null===this.nonResponses&&(this.nonResponses=[]),this.nonResponses=[],this.rangeController=(new s).initWithContent(this.responses),this.audioElement.src=this.audioFile,this.playAudio()}}})}});