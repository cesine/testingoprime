var Montage=require("montage/montage").Montage,Q=require("q");exports.Contextualizer=Montage.specialize({constructor:{value:function(){this.super(),this.defaultLocale="en",this.currentLocale=this.defaultLocale;var e=this;return this._contextualizationHolder=this._contextualizationHolder||{data:{},gimme:function(i){var o=Q.defer(),t=i;return window.setTimeout(function(){return e._contextualizationHolder.data[e.currentLocale]&&e._contextualizationHolder.data[e.currentLocale][i]&&void 0!==e._contextualizationHolder.data[e.currentLocale][i].message&&e._contextualizationHolder.data[e.currentLocale][i].message?(t=e._contextualizationHolder.data[e.currentLocale][i].message,console.log("Resolving localization quickly",t),o.resolve(t),void 0):(window.setTimeout(function(){e._contextualizationHolder.data[e.currentLocale]&&e._contextualizationHolder.data[e.currentLocale][i]&&void 0!==e._contextualizationHolder.data[e.currentLocale][i].message&&e._contextualizationHolder.data[e.currentLocale][i].message?t=e._contextualizationHolder.data[e.currentLocale][i].message:e._contextualizationHolder.data[e.currentLocale]&&e._contextualizationHolder.data[e.currentLocale][i]&&void 0!==e._contextualizationHolder.data[e.currentLocale][i].message&&e._contextualizationHolder.data[e.currentLocale][i].message,console.log("Resolving localization slowly",t),o.resolve(t)},1e3),void 0)},100),o.promise}},window.contextualizer=this,this}},_require:{value:"undefined"!=typeof global?global.require:"undefined"!=typeof window?window.require:null},_contextualizationHolder:{value:null},localize:{value:function(e){return this._contextualizationHolder.gimme(e)}},addFiles:{value:function(e){for(var i=[],o=this,t=0;e.length>t;t++){this._contextualizationHolder.data[e[t].localeCode]=this._contextualizationHolder.data[e[t].localeCode]||{},console.log("Loading "+e[t].path);var n=this._require.read(e[t].path);(function(e){n.then(function(i){return o.addMessagesToContextualizedStrings(i,e)})})(e[t].localeCode),i.push(n)}return Q.all(i)}},addMessagesToContextualizedStrings:{value:function(e,i){var o=Q.defer(),t=this;return window.setTimeout(function(){if(!e)return o.reject("No data"),void 0;e=JSON.parse(e);for(var n in e)e.hasOwnProperty(n)&&(t._contextualizationHolder.data[i][n]=e[n]);o.resolve("Okay")},100),o.promise}}});